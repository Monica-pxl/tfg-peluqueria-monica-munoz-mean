<section class="form-section d-flex justify-content-center align-items-center">
  <div class="form-card">
    @if(cargando) {
      <div class="text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-3">Cargando horario...</p>
      </div>
    }

    @if(!cargando && !error) {
      <div class="form-header">
        <i class="bi bi-pencil-square"></i>
        <h2 class="fw-bold mb-2">Editar Horario</h2>
        <p class="text-muted">Modifica el horario de {{ getNombreProfesional() }}</p>
      </div>

      <form (ngSubmit)="actualizarHorario()">
        <div class="mb-4">
          <label class="form-label">
            <i class="bi bi-person-fill me-2"></i>Profesional
          </label>
          <select 
            class="form-select form-control-custom" 
            [(ngModel)]="horario.id_profesional" 
            name="id_profesional" 
            required>
            @for (prof of profesionales; track prof.id_profesional) {
              <option [value]="prof.id_profesional">
                {{ prof.nombre }} {{ prof.apellidos }}
              </option>
            }
          </select>
        </div>

        <div class="mb-4">
          <label class="form-label mb-3">
            <i class="bi bi-calendar-week-fill me-2"></i>Días de la Semana
          </label>
          <div class="dias-container">
            @for (dia of diasSemana; track dia) {
              <button 
                type="button"
                class="btn-dia"
                [class.selected]="isDiaSeleccionado(dia)"
                (click)="toggleDia(dia)">
                {{ dia }}
              </button>
            }
          </div>
          <small class="text-muted ms-2">Selecciona los días que trabaja el profesional</small>
        </div>

        @if(horario.dias.length > 0) {
          <div class="mb-4">
            <label class="form-label mb-3">
              <i class="bi bi-calendar-event me-2 text-warning"></i>Fechas Festivas Específicas
            </label>
            <div class="row g-2 align-items-end mb-3">
              <div class="col-md-8">
                <input 
                  type="date" 
                  class="form-control form-control-custom" 
                  [(ngModel)]="nuevaFechaFestiva" 
                  [min]="fechaMinima"
                  name="nuevaFechaFestiva">
              </div>
              <div class="col-md-4">
                <button 
                  type="button" 
                  class="btn btn-warning w-100"
                  (click)="agregarFechaFestiva()">
                  <i class="bi bi-plus-circle me-1"></i>Añadir Fecha
                </button>
              </div>
            </div>
            
            @if(horario.fechas_festivas && horario.fechas_festivas.length > 0) {
              <div class="fechas-festivas-lista">
                @for (fecha of horario.fechas_festivas; track fecha) {
                  <div class="fecha-festiva-item">
                    <i class="bi bi-star-fill me-2"></i>
                    <span>{{ formatearFecha(fecha) }}</span>
                    <button 
                      type="button" 
                      class="btn-eliminar-fecha"
                      (click)="eliminarFechaFestiva(fecha)"
                      title="Eliminar fecha">
                      <i class="bi bi-x-circle"></i>
                    </button>
                  </div>
                }
              </div>
            } @else {
              <small class="text-muted">No hay fechas festivas configuradas</small>
            }
          </div>
        }

        <div class="row mb-4">
          <div class="col-md-6 mb-3 mb-md-0">
            <label class="form-label">
              <i class="bi bi-clock-fill me-2"></i>Hora Inicio
            </label>
            <input 
              type="time" 
              class="form-control form-control-custom" 
              [(ngModel)]="horario.hora_inicio" 
              name="hora_inicio" 
              required>
          </div>
          <div class="col-md-6">
            <label class="form-label">
              <i class="bi bi-clock me-2"></i>Hora Fin
            </label>
            <input 
              type="time" 
              class="form-control form-control-custom" 
              [(ngModel)]="horario.hora_fin" 
              name="hora_fin" 
              required>
          </div>
        </div>



        <div class="alert alert-info">
          <i class="bi bi-info-circle-fill me-2"></i>
          <strong>Nota:</strong> El sistema validará automáticamente que:
          <ul class="mb-0 mt-2">
            <li>La hora de inicio sea menor que la hora de fin</li>
            <li>El horario esté dentro de la jornada del centro</li>
            <li>No haya solapamiento con otros horarios del mismo profesional</li>
          </ul>
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-cancel" (click)="cancelar()">
            <i class="bi bi-x-circle me-2"></i>Cancelar
          </button>
          <button type="submit" class="btn btn-create">
            <i class="bi bi-check-circle me-2"></i>Actualizar Horario
          </button>
        </div>
      </form>
    }
  </div>
</section>
